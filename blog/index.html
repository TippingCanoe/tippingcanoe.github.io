
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Up The Creek</title>
  <meta name="author" content="Tipping Canoe">

  
  <meta name="description" content="Preamble Last time, we took a look at ion. This time, we&rsquo;re going to take a closer look at the syntax and features of another contender, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://upthecreek.tippingcanoe.com/blog">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/table.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Up The Creek" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Up The Creek</a></h1>
  
    <h2>Without a <code>Paddle();</code></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:upthecreek.tippingcanoe.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/27/benchmarking-android-networking-libraries-part-4-looking-at-robospice/">Benchmarking Android Networking Libraries - Part 4: Looking at Robospice</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-27T09:01:14-06:00" pubdate data-updated="true">Jan 27<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Preamble</h2>

<p>Last time, we took a <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/27/benchmarking-android-networking-libraries-part-3-looking-at-ion/">look at ion</a>. This time, we&rsquo;re going to take a closer look at the syntax and features of another contender, Robospice.</p>

<p>After looking at <a href="https://github.com/octo-online/RoboSpice-samples">some samples</a> provided by the Robospice team, it&rsquo;s becoming apparent that Robospice is a bit different than the other contenders. Whereas something like Retrofit is concerned with making requests and processing the results, Robospice is more concerned with the mechanics of where and how those requests take place, and what is done with the responses to make future requests easier. Robospice proposes that <a href="http://developer.android.com/guide/components/services.html">Android Services</a> are where networking should occur, rather than in a simple separate thread.</p>

<p>Robospice can be used with one of many of what it calls <code>SpiceServices</code> and each of those bring support for particular features to the table. Interestingly enough, there&rsquo;s a pre-built <a href="https://github.com/octo-online/robospice/wiki/Retrofit-module"><code>SpiceService</code> for Retrofit</a>, so we&rsquo;re going to jump on that and see what Robospice really brings to the table ontop of Retrofit.</p>

<h2>Common setup</h2>

<p>Setup for our POJO objects is the same as described in <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/27/benchmarking-android-networking-libraries-part-3-looking-at-ion/">part 3</a>.</p>

<h2>Setup</h2>

<p>Stepping back slighty, in the previous post we actually installed the wrong version of Robospice. There&rsquo;s a version specifically built for using alongside Retrofit.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">compile</span> <span class="s1">&#39;com.octo.android.robospice:robospice-retrofit:1.4.2&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we&rsquo;re using Retrofit under the hood, we&rsquo;ll need to create an interface for our API.<br/>
*Note: This code snippet returns the result directly, as opposed to using a callback. Retrofit uses this as a mechanic to determine wheter to execute the request synchronously (which it does when values are returned) or asynchronously (when values are consumed by a callback). In the Robospice world, the request is already being done in a Service, so there is no need to spawn a separate thread.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Testbed</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getIndex</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/user&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getUsers</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/user/{id}&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">User</span> <span class="nf">getUser</span><span class="o">(</span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">userId</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@POST</span><span class="o">(</span><span class="s">&quot;/user&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">User</span> <span class="nf">createUser</span><span class="o">(</span><span class="nd">@Body</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@POST</span><span class="o">(</span><span class="s">&quot;/user/{id}&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">User</span> <span class="nf">updateUser</span><span class="o">(</span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">userId</span><span class="o">,</span> <span class="nd">@Body</span> <span class="n">User</span> <span class="n">user</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we&rsquo;ll also need a Robospice Service class to represent our API. The overriden <code>protected Converter createConverter()</code> method is used to inject the <code>new GsonBuilder()</code> that we made way up at the beginning of this post.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestbedSpiceService</span> <span class="kd">extends</span> <span class="n">RetrofitGsonSpiceService</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">&quot;@TODO&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>        <span class="n">addRetrofitInterface</span><span class="o">(</span><span class="n">Testbed</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getServerUrl</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">BASE_URL</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">Converter</span> <span class="nf">createConverter</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">GsonConverter</span><span class="o">(</span><span class="n">gson</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note we can also use our Jackson converter with Robospice via Retrofit. Here&rsquo;s how to set it up, but we&rsquo;ll be omitting these examples for the moment. The overriden <code>protected Converter createConverter()</code> method is used to inject the <code>new ObjectMapper()</code> that we made way up at the beginning of this post.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestbedSpiceServiceJackson</span> <span class="kd">extends</span> <span class="n">RetrofitJackson2SpiceService</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">&quot;@TODO&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
</span><span class='line'>        <span class="n">addRetrofitInterface</span><span class="o">(</span><span class="n">Testbed</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getServerUrl</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">BASE_URL</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">Converter</span> <span class="nf">createConverter</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">JacksonConverter</span><span class="o">(</span><span class="n">jackson</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That new service will need to be declard in our <code>AndroidManifest.xml</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;service</span>
</span><span class='line'>  <span class="na">android:name=</span><span class="s">&quot;TestbedSpiceService&quot;</span>
</span><span class='line'>  <span class="na">android:exported=</span><span class="s">&quot;false&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Forming a request</h2>

<p>Robospice uses classes to represent requests and responses, so we&rsquo;ll need to create one for each pair.</p>

<p>Requests go into their own Class files.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GetUsersRequest</span> <span class="kd">extends</span> <span class="n">RetrofitSpiceRequest</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;,</span> <span class="n">Testbed</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="nf">GetUsersRequest</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;.</span><span class="na">class</span><span class="o">,</span> <span class="n">Testbed</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">loadDataFromNetwork</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nf">getService</span><span class="o">().</span><span class="na">getIndex</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Handling a response</h2>

<p>Responses go into each Activity (or Fragment) that&rsquo;s listening for the response. Conceptually, this makes a lot of sense &ndash; requests are general purpose and likely reused throughout the Application, and responses need UI work that&rsquo;s specific to that situation.</p>

<p>Robospice requires some additions to our Activities in order for that to function. The idea of having boilerplate code laying around to support a Library doesn&rsquo;t sound that great, but it&rsquo;s minimal for now. Of course, we&rsquo;re going to be clever developers and add this into an abstract Activity subclass so that we don&rsquo;t have to copy/paste it into all of our Activities down the line.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">SpicedActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">SpiceManager</span> <span class="n">spiceManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpiceManager</span><span class="o">(</span><span class="n">TestbedSpiceService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">spiceManager</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onStart</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">spiceManager</span><span class="o">.</span><span class="na">shouldStop</span><span class="o">();</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">protected</span> <span class="n">SpiceManager</span> <span class="nf">getSpiceManager</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">spiceManager</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then we&rsquo;ll add the handling of the response from the service in our Activity that extends the <code>SpicedActivity</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="err">@</span><span class="nc">TODO</span> <span class="kd">extends</span> <span class="n">SpicedActivity</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">GetUsersRequest</span> <span class="n">getUsersRequest</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">GetUsersRequestListener</span> <span class="kd">implements</span> <span class="n">RequestListener</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestFailure</span><span class="o">(</span><span class="n">SpiceException</span> <span class="n">spiceException</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequestSuccess</span><span class="o">(</span><span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Executing a request</h2>

<p>And then we just need to add a line to instantiate and trigger the request and pipe the result to the response.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">getUsersRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetUsersRequest</span><span class="o">();</span>
</span><span class='line'><span class="n">getSpiceManager</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="n">getUsersRequest</span><span class="o">,</span> <span class="s">&quot;getUsers&quot;</span><span class="o">,</span> <span class="n">DurationInMillis</span><span class="o">.</span><span class="na">ONE_MINUTE</span><span class="o">,</span> <span class="k">new</span> <span class="n">GetUsersRequestListener</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Other features</h2>

<ul>
<li><strong>Cacheing</strong>
  That last line has a couple of neat features. First, we can set a key by which to recognize future requests of this type in a cache (we&rsquo;re just using a dumb string <code>"getUsers"</code>, but you could implement your own mechasim of course) and second, we can state how long that cache is valid for. In this example, if we were to execute the same request 2 times within a minute, the n+1 requests wouldn&rsquo;t actually trigger any network activity.</li>
<li><strong>Priority</strong>
  Requests can have a priority attached to them, and Robospice will attempt to execute higher priority ones first.
  <code>java
  getUsersRequest.setPriority(SpiceRequest.PRIORITY_HIGH);
 </code></li>
<li><p><strong>Cancelling</strong>
  Requests can be cancelled in a few ways. The first is to use the request itself.</p>

<p>  <code>java
  getUsersRequest.cancel();
 </code></p>

<p>  But that could be suboptimal because the Object may have left your context. A better way is by using the cache key.</p>

<p>  <code>java
  spiceManager.cancel("getUsers");
 </code></p></li>
<li><p><strong>Retrying</strong>
  If requests fail (for example, the user&rsquo;s network connectivity drops in the middle of sending a request), Robospice can automatically queue those requests again. A default <a href="https://github.com/octo-online/robospice/blob/release/robospice-core-parent/robospice/src/main/java/com/octo/android/robospice/retry/DefaultRetryPolicy.java"><code>DefaultRetryPolicy</code></a> exists for requests by default, but you can implement your own by implementing <a href="https://github.com/octo-online/robospice/blob/release/robospice-core-parent/robospice/src/main/java/com/octo/android/robospice/retry/RetryPolicy.java"><code>RetryPolicy</code></a>.</p>

<p>  <code>java
  getUsersRequest.setRetryPolicy(YourRetryPolicy);
 </code></p></li>
<li><p><strong>Image loading</strong>
  Robospice <em>does</em> support downloading images, but does so by requiring you to use a <a href="https://github.com/octo-online/robospice/wiki/UI-SpiceList-module"><code>UI SpiceList</code></a> that imposes several requirements on your ListViews/Adapters. After trying to work with the sample, we decided this implementation was not worth persuing.</p></li>
</ul>


<h2>Thoughts</h2>

<p>That was a lot of work and, possibly, a lot of duplication between Retrofit and Robospice. Let&rsquo;s imagine that the &lsquo;/users&rsquo; route of our API suddenly changes and adds a parameter to toggle some functionality. In this example, we would need to touch <code>public interface Testbed</code>, <code>public class GetUsersRequest</code>, and our Activity. Here be dragons.</p>

<p>On the other hand, it&rsquo;s possible that this work is worth it. The Robospice team seems <a href="https://raw.github.com/octo-online/robospice/master/gfx/RoboSpice-InfoGraphics.png">confident that Services are the way to go</a> for networking request, and the cacheing features are a nice bonus.</p>

<p>The fact that Robospice can work with a variety of Services makes it so their documentation is quite difficult to parse. You&rsquo;ll find some examples designed for Spring, some for OkHTTP, etc. We found that the guides and documentation do not make it clear how to swap between these Services, and can easily lead you astray.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/27/benchmarking-android-networking-libraries-part-3-looking-at-ion/">Benchmarking Android Networking Libraries - Part 3: Looking at Ion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-27T09:00:59-06:00" pubdate data-updated="true">Jan 27<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Preamble</h2>

<p>Last time, we managed to get all of our <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/24/benchmarking-android-networking-libraries-part-2-installing-libraries/">contenders installed</a>. This time, we&rsquo;re going to take a closer look at the syntax and features of one of our contenders, ion.</p>

<p>ion comes from the creator of <a href="https://github.com/koush/AndroidAsync">AnroidAsync</a> and uses that library for its low-level networking. This is actually the library that we&rsquo;re currently using in our legacy Applications.</p>

<h2>Common setup</h2>

<p>POJO
: A POJO is, simply, a plain-old-java-object. These are just your standard, existing business objects.
Gson
: <a href="https://code.google.com/p/google-gson/">Gson</a> is a library used to convert between POJOs and JSON.
Jackson
: <a href="https://github.com/FasterXML/jackson">Jackson</a> is an alternative library used to convert between POJOs and JSON. <a href="http://blaazinsoftwaretech.blogspot.ca/2013/08/jackson-2-vs-gson-performance-comparison.html">Some</a> <a href="http://daniel-codes.blogspot.ca/2013/12/streaming-json-parsing-performance-test.html">developers</a> report it being much faster than GSON, so we&rsquo;ll be testing both out.</p>

<p>So, we&rsquo;re going to need a POJO for Gson &amp; Jackson to use to represent our User object.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="n">String</span> <span class="n">emailAddress</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="n">isAdmin</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Constructor/getters/setters ommitted</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The one line there that might not look familliar is the <code>@SerializedName</code> annotation. If you remember back to <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/24/benchmarking-android-networking-libraries/">part one</a>, our testbed&rsquo;s User object had the property for the email address as <code>email</code>, not <code>emailAddress</code>. This annotation will let us override it.</p>

<p>You&rsquo;ll also remember that the User object had a property called <code>is_admin</code>, not <code>isAdmin</code>. We could fix this in the same way as the email address, but Gson provides a nice way of altering underscore/camelcaseing in a standard way.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">()</span>
</span><span class='line'>  <span class="o">.</span><span class="na">setFieldNamingPolicy</span><span class="o">(</span><span class="n">FieldNamingPolicy</span><span class="o">.</span><span class="na">LOWER_CASE_WITH_UNDERSCORES</span><span class="o">)</span>
</span><span class='line'>  <span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, there are loads more features, so you should be familliar with <a href="https://sites.google.com/site/gson/gson-user-guide">how to work with Gson</a> as many of the REST libraries we&rsquo;re going to be testing use it.</p>

<p>And just to keep the annotations separate in our minds, we&rsquo;ll create a separate class for Jackson.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@JsonIgnoreProperties</span><span class="o">(</span><span class="n">ignoreUnknown</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="nd">@JsonAutoDetect</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserJackson</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@JsonProperty</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@JsonProperty</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@JsonProperty</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="n">String</span> <span class="n">emailAddress</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@JsonProperty</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">boolean</span> <span class="n">isAdmin</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Constructor/getters/setters ommitted</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A few more annotations required there, so let&rsquo;s go through them.
* <code>@JsonIgnoreProperties(ignoreUnknown=true)</code> simply flags Jackson to say that if there are additional properties in the JSON that aren&rsquo;t a part of this Object to not worry about it. Just ignore them.
* <code>@JsonAutoDetect</code> signals Jackson that we want it to automatically find mappings between our POJO and JSON.
* <code>@JsonProperty</code> signals that this property is mapped to JSON. We can also override the name using the <code>value = "foo"</code> syntax.</p>

<p>Same as with GSON, we&rsquo;ll need to apply a strategy to overcome <code>is_admin</code> to <code>isAdmin</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ObjectMapper</span> <span class="n">jackson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
</span><span class='line'><span class="n">jackson</span><span class="o">.</span><span class="na">setPropertyNamingStrategy</span><span class="o">(</span><span class="n">PropertyNamingStrategy</span><span class="o">.</span><span class="na">CAMEL_CASE_TO_LOWER_CASE_WITH_UNDERSCORES</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setup</h2>

<p>The one thing that we&rsquo;ll need to do is inject our <code>new GsonBuilder()</code> that we built above.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Ion</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(</span><span class="n">activity</span><span class="o">).</span><span class="na">setGson</span><span class="o">(</span><span class="n">gson</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Executing a request</h2>

<p>ion makes it really nice and easy to just work with the basic string response from the API.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">indexRequest</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">&quot;@TODO&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">.</span><span class="na">asString</span><span class="o">()</span>
</span><span class='line'>  <span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Or as a JSONObject or JSONArray using <code>.asJsonObject()</code> or <code>.asJsonArray()</code>. Or as a POJO using Gson.<br/>
<em>Note: At the time of writing, ion does not have built-in support for Jackson.</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="n">getUsers</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="s">&quot;@TODO&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;(){})</span>
</span><span class='line'>  <span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Other features</h2>

<ul>
<li><p><strong>Progress</strong>
  ion has some really nice plugins for retrieving the progress of any request</p>

<p>  &#8220;` java
  indexRequest
      .progressBar(yourProgressBarHere)
      .progressDialog(yourProgressDialogHere)
      .progress(new ProgressCallback() {
          @Override
          public void onProgress(int downloaded, int total) {</p>

<pre><code>      }
  });
</code></pre>

<p>  &#8220;`</p></li>
<li><p><strong>Image loading</strong></p>

<p>  <code>java
  Ion.with(yourImageViewHere)
      .placeHolder(R.drawable.yourPlaceholderGraphicHere)
      .error(R.drawable.yourErrorGraphicHere)
      .animateLoad(yourAnimationHere)
      .animateIn(yourAnimationHere)
      .centerInside()
      .resize(100, 200)
      .transform(MyTransformation)
      .load("http://example.com/image.png");
 </code></p>

<p>  The <code>MyTransformation</code> must be an implementation of <a href="https://github.com/koush/ion/blob/master/ion/src/com/koushikdutta/ion/bitmap/Transform.jav%0A%20%20a"><code>Transform</code></a></p></li>
<li><p><strong>Cancelling requests</strong>
  Requests can be canncelled individually.</p>

<p>  <code>java
  getUsers.cancel();
 </code></p>

<p>  Or per-activity. Doing this call in the <code>onStop()</code> of an Activity makes a lot of sense.</p>

<p>  <code>java
  Ion.getDefault(activity).cancelAll(activity);
 </code></p>

<p>  Or per-group.</p>

<p>  <code>java
  Object usersGroup = new Object();
  Future&lt;List&lt;User&gt;&gt; getUsers = Ion.with(getApplicationContext(), "@TODO")
      .as(new TypeToken&lt;List&lt;User&gt;&gt;(){})
      .group(usersGroup)
      .setCallback(new FutureCallback&lt;List&lt;User&gt;&gt;() {
          @Override
          public void onCompleted(Exception e, List&lt;User&gt; result) {
          }
      });
  Ion.getDefault(activity).cancelAll(usersGroup);
 </code></p></li>
</ul>


<h2>Thoughts</h2>

<p>The syntax for ion is certainly attractive. There is very little boilerplate code involved and there are some very attractive helpers that it gives. Of special note is the ability to &ldquo;drop&rdquo; between parsers so easily &ndash; in a perfect world, your API returns beautiful JSON that is consumed by Gson magically&hellip; in the real world, there are perfectly valid scenarios where API responses aren&rsquo;t JSON at all.</p>

<p>However, the fact that ion works in such a loose fashion may come to hurt a project after a long time. In our legacy code, the fact that AndroidAsync events are so &ldquo;easy&rdquo; to program (and ion events seem even easier) has lead to far too much thinking of functions as scripts and not objects &ndash; the proof of this is copy-pasted versions of AndroidAsync events throughout the sourcecode, instead of thinking of the API as an object the way that most of these other libraries do.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/24/benchmarking-android-networking-libraries-part-2-installing-libraries/">Benchmarking Android Networking Libraries - Part 2: Installing Libraries</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-24T12:22:20-06:00" pubdate data-updated="true">Jan 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Preamble</h2>

<p>Where we <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/24/benchmarking-android-networking-libraries/">last left our heroes</a>, we&rsquo;d setup a <a href="http://github.com/TippingCanoe/rest-api-testbed">testbed</a> using <a href="http://www.laravel.com">Laravel 4</a> to compare the speeds Android networking libraries. This time around, we&rsquo;re going to look at creating an Android Application to test these libraries out.</p>

<h2>Creating the Application</h2>

<p>As mentioned in <a href="http://upthecreek.tippingcanoe.com/blog/2014/01/24/benchmarking-android-networking-libraries/">part one</a> of this discussion, using modern tools to build our Applications has become a big focus for us at <a href="http://tippingcanoe.com/">Tipping Canoe</a>. The new hotness of <a href="http://tools.android.com/tech-docs/new-build-system">Gradle</a> and <a href="http://developer.android.com/sdk/installing/studio.html">Android Studio</a> have replaced the old bustedness of Eclipse and ANT for us, so having libraries available in a format that gels with proper dependency management is a big win and, in our opinion, a litmus test for the quality of a library.</p>

<p>We&rsquo;ll use the Android Studio new project wizard to create our project.</p>

<p><img src="http://upthecreek.tippingcanoe.com/assets/new_project.png" alt="Android Studio new Application" /></p>

<p>Once the project has booted, a majority of the work will be done in the <code>build.gradle</code> file.<br/>
<em>Note: There are actually two <code>build.gradle</code> files, one in the outer project and one in the inner module for our Application. For the moment, the inner one is where we will be concentrating. However, at the time of writing a new update to Android Studio was pushed which introduced version <code>0.8</code> of the gradle plugin, which may have changed this.</em></p>

<p><img src="http://upthecreek.tippingcanoe.com/assets/new_project_done.png" alt="Android Studio new Application" /></p>

<p>The one improvement that I&rsquo;d suggest making is changing the <code>.gitignore</code> file. If you&rsquo;re working in a team all using Android Studio, there are actually a few settings in projects that you might want to share between your developers. Most <code>.gitignore</code> files will have you ignoring the entire <code>/.idea</code> folder, so you&rsquo;ll lose things like code style settings, which, in our mind, make sense to enforce and share amongst your team.</p>

<figure class='code'><figcaption><span>One .gitignore to rule them all</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'># Built application files
</span><span class='line'>/*/build/
</span><span class='line'>
</span><span class='line'># Crashlytics configuations
</span><span class='line'>com_crashlytics_export_strings.xml
</span><span class='line'>
</span><span class='line'># Local configuration file (sdk path, etc)
</span><span class='line'>local.properties
</span><span class='line'>
</span><span class='line'># Gradle generated files
</span><span class='line'>.gradle/
</span><span class='line'>
</span><span class='line'># Signing files
</span><span class='line'>.signing/
</span><span class='line'>
</span><span class='line'># User-specific configurations
</span><span class='line'>.idea/libraries/
</span><span class='line'>.idea/workspace.xml
</span><span class='line'>.idea/tasks.xml
</span><span class='line'>.idea/.name
</span><span class='line'>.idea/compiler.xml
</span><span class='line'>.idea/copyright/profiles_settings.xml
</span><span class='line'>.idea/encodings.xml
</span><span class='line'>.idea/misc.xml
</span><span class='line'>.idea/modules.xml
</span><span class='line'>.idea/scopes/scope_settings.xml
</span><span class='line'>.idea/vcs.xml
</span><span class='line'>*.iml
</span><span class='line'>
</span><span class='line'># OS-specific files
</span><span class='line'>.DS_Store
</span><span class='line'>.DS_Store?
</span><span class='line'>._*
</span><span class='line'>.Spotlight-V100
</span><span class='line'>.Trashes
</span><span class='line'>ehthumbs.db
</span><span class='line'>Thumbs.db
</span></code></pre></td></tr></table></div></figure>


<h3>Installing Retrofit</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.squareup.retrofit:retrofit:1.3.0&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installing Volley</h3>

<p><a href="http://developers.google.com/events/io/sessions/325304728">Volley</a> isn&rsquo;t available in Maven at the time of writing. In fact, finding a download for it at all is a little tricky. For shame, Google. Thankfully <a href="https://github.com/vinc3m1">Vince Mi</a> has done us a great service in wrapping Volley in Maven repository he calls <a href="https://github.com/ark/ark">Ark</a>.</p>

<p>So, we just need to add Ark.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">mavenCentral</span><span class="o">()</span>
</span><span class='line'>  <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">url</span> <span class="s1">&#39;https://raw.github.com/ark/ark/master/releases/&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">url</span> <span class="s1">&#39;https://raw.github.com/ark/ark/master/snapshots/&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then add Volley.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.frameworks:volley:master-SNAPSHOT&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installing ion</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.koushikdutta.ion:ion:1.2.1&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installing Robospice</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.octo.android.robospice:robospice:1.4.2&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Installing Picasso</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.android.support:appcompat-v7:+&#39;</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.squareup.picasso:picasso:2.1.1&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Thoughts</h2>

<p>Two things came up as a result of this,</p>

<p>First, it&rsquo;s interesting to note that the only library that fails at being dead simple to install and manage is the &ldquo;offical&rdquo; one provided by Google. As tempting as it is to assume that Google&rsquo;s solutions are always going to be the best, there&rsquo;s somewhat of a track record of projects being abandonded without warning to developers using or relying on them. The optimist would say that Google knows Gradle/Maven are going to be replaced by some secret project in the near future. The pessimest would say that this is a sign that Volley might not be a long-term supported project.</p>

<p>Second, this may be an extremely temporal thing that only exists at the time of writing, but Robo Spice generated an error while compiling;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./gradlew build
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>UNEXPECTED TOP-LEVEL EXCEPTION:
</span><span class='line'>com.android.dex.DexException: Multiple dex files define Landroid/support/v4/accessibilityservice/
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>What the heck? From the looks of that error message, something in Robo Spice is trying to include something that&rsquo;s conflicting with our version of the Android support library.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./gradlew -q dependencies networkLibraryTest:dependencies
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>_debugApk
</span><span class='line'>+--- com.android.support:appcompat-v7:+ -&gt; 19.0.1
</span><span class='line'>|    <span class="se">\-</span>-- com.android.support:support-v4:19.0.1
</span><span class='line'>+--- com.squareup.retrofit:retrofit:1.3.0
</span><span class='line'>|    <span class="se">\-</span>-- com.google.code.gson:gson:2.2.4
</span><span class='line'>+--- com.android.frameworks:volley:master-SNAPSHOT
</span><span class='line'>+--- com.koushikdutta.ion:ion:1.2.1
</span><span class='line'>|    +--- com.google.code.gson:gson:2.2.4
</span><span class='line'>|    <span class="se">\-</span>-- com.koushikdutta.async:androidasync:1.2.1
</span><span class='line'>+--- com.octo.android.robospice:robospice:1.4.2
</span><span class='line'>|    <span class="se">\-</span>-- com.octo.android.robospice:robospice-cache:1.4.1
</span><span class='line'>|         +--- org.apache.commons:commons-lang3:3.1
</span><span class='line'>|         +--- org.apache.commons:commons-io:1.3.2
</span><span class='line'>|         |    <span class="se">\-</span>-- commons-io:commons-io:1.3.2
</span><span class='line'>|         <span class="se">\-</span>-- com.google.android:support-v4:r7
</span><span class='line'><span class="se">\-</span>-- com.squareup.picasso:picasso:2.1.1
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>The solution was to stop it from attempting to compile that module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">compile</span> <span class="o">(</span><span class="s1">&#39;com.octo.android.robospice:robospice:1.4.2&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">exclude</span> <span class="nl">module:</span> <span class="s1">&#39;support-v4&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Scorecard</h2>

<table>
<thead>
<tr>
<th>Library   </th>
<th align="right"> Score </th>
<th> Notes                                     </th>
<th align="right"> Running Tally</th>
</tr>
</thead>
<tbody>
<tr>
<td>Retrofit  </td>
<td align="right">    +1 </td>
<td>                                           </td>
<td align="right">             1</td>
</tr>
<tr>
<td>Volley    </td>
<td align="right">    -1 </td>
<td> Not available in modern dependency tools. </td>
<td align="right">            -1</td>
</tr>
<tr>
<td>ion       </td>
<td align="right">    +1 </td>
<td>                                           </td>
<td align="right">             1</td>
</tr>
<tr>
<td>Robospice </td>
<td align="right">     0 </td>
<td> Generated build errors.                   </td>
<td align="right">             0</td>
</tr>
<tr>
<td>Picasso   </td>
<td align="right">    +1 </td>
<td>                                           </td>
<td align="right">             1</td>
</tr>
</tbody>
</table>


<p>Five Android libraries installed with only minimal configuration hell?</p>

<p><img src="http://www.reactionface.info/sites/default/files/images/YvEN9.png" alt="Not bad" /></p>

<h2>Repository</h2>

<p>I&rsquo;ve committed the source code for this example up to <a href="https://github.com/TippingCanoe/network-library-test/releases/tag/step-2">Github</a>.</p>

<h2>Next steps</h2>

<p>Next, we&rsquo;re going to look at performing basic REST requests in the different frameworks.</p>
</div>
  
  

</article>


    <article class="post">
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/24/benchmarking-android-networking-libraries/">Benchmarking Android Networking Libraries - Part 1: Rest API Testbed.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-24T08:39:46-06:00" pubdate data-updated="true">Jan 24<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Preamble</h2>

<p>Over the last few months here at <a href="http://tippingcanoe.com/">Tipping Canoe</a> we&rsquo;ve really been trying to up our Android development game. Our primary web-language, <a href="http://www.php.net/">PHP</a> has been going through somewhat of a renaissance, largely spurred by usage of <a href="https://getcomposer.org/">Composer</a> to think of your Application as a set of small, reusable, and interchangeable components controlled by a proper dependency management system. The Android world seems to be lagging behind on this, with a vast majority of tutorials online (including <a href="http://developer.android.com/tools/support-library/setup.html">loads from Google</a>) suggesting that manually copying <code>.jar</code> files around is a sane way of managing your Application&rsquo;s dependencies.</p>

<p><span class='pullquote-right' data-pullquote='if you&#8217;re using Eclipse and ANT, you&#8217;re doing modern Android development wrong'>
Luckily, it seems there might be light at the end of the tunnel. Thanks to the <a href="http://tools.android.com/tech-docs/new-build-system">&ldquo;new build system&rdquo;</a> powered by Gradle, Android developers can now declare their dependencies in a configuration file and have the build system be responsible for filling those dependencies. I&rsquo;ll hopefully be doing another blog post about our journey moving to this new way of doing things later, but the short version is, if you&rsquo;re using Eclipse and ANT, you&rsquo;re doing modern Android development wrong. Configuration-hell is a place you shouldn&rsquo;t have to live in.
</span></p>

<p>Since this change, the quality and quantity of open source Android libraries is slowly slowly starting to grow, and it&rsquo;s an important part of our job to vet what&rsquo;s available out there to make sure we&rsquo;re making the right decisions &mdash; which lead me to this experiment. A common theme across all of our current Applications is that they all rely on and communicate with a remote REST client and retrieve images and other resources from remote locations.</p>

<h2>Contenders</h2>

<p>After a bit or lurking in <a href="http://www.reddit.com/r/androiddev/">/r/androiddev</a>, here are what I believe to be the contenders.</p>

<p>For networking/REST;</p>

<ol>
<li><a href="http://square.github.io/retrofit/">Retrofit</a> by Square.</li>
<li><a href="http://developers.google.com/events/io/sessions/325304728">Volley</a> by Google.</li>
<li><a href="http://github.com/koush/ion">ion</a> by Koushik Dutta.</li>
<li><a href="http://github.com/octo-online/robospice">Robospice</a> by Octo Technology.</li>
</ol>


<p>For image loading;</p>

<ol>
<li><a href="http://developers.google.com/events/io/sessions/325304728">Volley</a> by Google.</li>
<li><a href="http://github.com/koush/ion">ion</a> by Koushik Dutta.</li>
<li><a href="http://square.github.io/picasso/">Picasso</a> by Square.</li>
</ol>


<h2>Testbed</h2>

<p>To accurately compare these libraries, we&rsquo;re going to need a simple testbed to act as a REST server. Lately, we&rsquo;ve been using <a href="http://laravel.com/">Laravel 4</a>, a PHP framework, for lots of our API development, so I&rsquo;m going to build a quick testbed using it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>composer create-project laravel/laravel testbed --prefer-dist
</span></code></pre></td></tr></table></div></figure>


<h3>Tables</h3>

<p>First, we&rsquo;re going to need a database to save our results to. For quick bootup, we&rsquo;re just going to go into the <code>/app/config/database.php</code> and setup a SQLite database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we&rsquo;ll need to create some database tables for some Models we&rsquo;re going to need storage for.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php artisan migrate:make create_users_table --create<span class="o">=</span>users
</span><span class='line'>php artisan migrate:make create_requests_table --create<span class="o">=</span>requests
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ll add some information to those tables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">boolean</span><span class="p">(</span><span class="s1">&#39;is_admin&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">&#39;requests&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">&#39;client_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unique</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">enum</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">enum</span><span class="p">(</span><span class="s1">&#39;engine&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;retrofit&#39;</span><span class="p">,</span> <span class="s1">&#39;volley&#39;</span><span class="p">,</span> <span class="s1">&#39;ion&#39;</span><span class="p">,</span> <span class="s1">&#39;robospice&#39;</span><span class="p">]);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s1">&#39;start_time&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">(</span><span class="s1">&#39;end_time&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we&rsquo;ll run those migrations to actually create the tables.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php artisan migrate
</span></code></pre></td></tr></table></div></figure>


<h3>Models</h3>

<p>Now that we&rsquo;ve got storage rolling, we&rsquo;ll need to make some Models.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">Request</span> <span class="k">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;requests&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$softDelete</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Eloquent</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$softDelete</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Routes</h3>

<p>And now we&rsquo;ll add some REST routes to the <code>/app/routes.php</code> file.<br/>
<em>Note: If you add code into your routes file like this, it&rsquo;ll make web-developers cry. Use Controllers.</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nv">$startTime</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;requestEnd&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$route</span><span class="p">,</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$startTime</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nv">$requestTiming</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RequestTiming</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="na">all</span><span class="p">());</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">method</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">server</span><span class="p">(</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">path</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">path</span><span class="p">();</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">parameters</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="na">all</span><span class="p">());</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">start_time</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:m:s&quot;</span><span class="p">,</span> <span class="nv">$startTime</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">end_time</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:m:s&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$requestTiming</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;api&#39;</span><span class="p">,</span> <span class="s1">&#39;after&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;requestEnd:&#39;</span> <span class="o">.</span> <span class="nv">$startTime</span><span class="p">],</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Get some sample JSON</span>
</span><span class='line'>  <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="s2">&quot;Hello World!&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Get an array of all Users</span>
</span><span class='line'>  <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">all</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$users</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Get a specific User</span>
</span><span class='line'>  <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Create a new User</span>
</span><span class='line'>  <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="na">all</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span> <span class="nv">$avatar</span> <span class="o">=</span> <span class="nx">Input</span><span class="o">::</span><span class="na">hasFile</span><span class="p">(</span><span class="s1">&#39;avatar&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nv">$avatar</span><span class="o">-&gt;</span><span class="na">move</span><span class="p">(</span><span class="nx">storage_path</span><span class="p">(),</span> <span class="s2">&quot;avatar_&quot;</span> <span class="o">.</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">.</span> <span class="s2">&quot;.&quot;</span> <span class="o">.</span> <span class="nv">$avatar</span><span class="o">-&gt;</span><span class="na">getClientOriginalExtension</span><span class="p">());</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Update a User</span>
</span><span class='line'>  <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/user/{id}&#39;</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nx">Input</span><span class="o">::</span><span class="na">all</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="nx">Response</span><span class="o">::</span><span class="na">json</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Repository</h2>

<p>I&rsquo;ve committed the source code for this example up to <a href="http://github.com/TippingCanoe/rest-api-testbed">Github</a>.</p>

<h2>Next steps</h2>

<p>Next, we&rsquo;re going to move over to Android and get these libraries installed!</p>
</div>
  
  

</article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Tipping Canoe -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tc-upthecreek';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
